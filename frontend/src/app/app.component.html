<div class="container">
  <h1>{{ titulo }}</h1>

  <section class="card">
    <h2>Registrar venta</h2>
    <form [formGroup]="form" (ngSubmit)="addItem()" novalidate>
      <div class="row">
        <label>Producto</label>
        <input type="text" formControlName="product" placeholder="Empieza a escribir" (input)="applyFilter()" [(ngModel)]="searchTerm" name="searchTerm" />
      </div>

      <div class="row">
        <label>Cantidad</label>
        <input type="number" formControlName="quantity" min="1" />
      </div>

      <div class="row">
        <label>Precio unitario</label>
        <input type="number" step="0.01" formControlName="unitPrice" />
      </div>

      <button type="submit">Agregar al ticket</button>
    </form>

    <div class="suggestions" *ngIf="filtered.length && searchTerm">
      <button class="chip" *ngFor="let p of filtered" (click)="selectProduct(p)">
        {{ p.name }} · ${{ p.unitPrice | number:'1.0-0' }} COP · stock: {{ p.stock }}
      </button>
    </div>
    <div *ngIf="error" class="error">{{ error }}</div>
  </section>

  <section class="card">
    <div class="header">
      <h2>Ticket</h2>
      <button type="button" (click)="generateTicket()" [disabled]="!items.length">Generar Ticket</button>
    </div>

    <table *ngIf="items.length" class="table">
      <thead>
      <tr>
        <th>Producto</th>
        <th>Cantidad</th>
        <th>Precio Unitario</th>
        <th>Subtotal</th>
        <th></th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let it of items; let i = index">
        <td>{{ it.productName }}</td>
        <td>{{ it.quantity }}</td>
        <td>${{ it.unitPrice | number:'1.0-0' }} COP</td>
        <td>${{ it.subtotal | number:'1.0-0' }} COP</td>
        <td><button (click)="removeItem(i)">Quitar</button></td>
      </tr>
      </tbody>
      <tfoot>
      <tr>
        <th colspan="3" style="text-align:right">Total</th>
        <th>${{ total | number:'1.0-0' }} COP</th>
        <th></th>
      </tr>
      </tfoot>
    </table>

    <p *ngIf="!items.length" class="muted">Aún no has agregado productos</p>
  </section>
</div>
